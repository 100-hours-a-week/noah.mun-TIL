# 쿠버네티스 상세 개념

---

### 쿠버네티스의 필요성

<aside>
📖

쿠버네티스는 수많은 컨테이너를 관리하는 시스템이다.
서버를 다수 운영해야 한다면 서로 다른 서버에서 작동하는 수많은 컨테이너를 한꺼번에 관리하는 것은 매우 어려운 일임

ex. 실행해야 하는 컨테이너가 100개라면, docker container run을 100번 입력해야 한다.

이 뿐만 아니라 실행 중인 컨테이너에 문제가 생겼을 경우에 대응하는 일도 매우 어렵다.

</aside>

### 쿠버네티스 클러스터

![스크린샷 2025-03-11 오전 10.11.38.png](/images/3-11_1.png)

위 그림을 보면 쿠버네티스는 크게 마스터 노드와 워커 노드로 구분되는 것을 알 수 있다.

`개발자`는 `마스터 노드`와 통신하며 `사용자`는 인터넷을 통해 `워커 노드`와 통신하는 경우가 많다.

위 그림과 같은 구조를 유지하기 위해서는 마스터 노드와 워커 노드 간의 유기적인 통신이 중요하다. 이를 위해 CNI(Container Network Interfaces)라는 개념이 사용된다.

<aside>
📖

CNI

쿠버네티스 클러스터에 존재하는 컨테이너 간의 통신을 위해 필요한 인터페이스

CNI를 사용하기 위해 쿠버네티스 네트워크 플러그인을 제공하는데, 대표적인 플러그인은 Flannel과 calico이다. (대표적으로 calico를 많이 사용)

</aside>

### 컨트롤 플레인

<aside>
📖

쿠버네티스 클러스터 전반의 작업을 관리하는 역할을 수행

위 그림을 보면 알 수 있듯 API 서버, etcd, 스케줄러, 컨트롤러 매니저로 구성되어 있다.

</aside>

***API 서버***

쿠버네티스 작업은 `kubectl` 명령어를 통해 마스터 노드의 kube-apiserver에게 API 요청을 보냄으로써 이루어진다. API 서버는 쿠버네티스 컨트롤 플레인에서의 FE 역할을 함

***etcd***

쿠버네티스 클러스터에 존재하는 모든 데이터를 저장하는 key-value 저장소이다.

***스케줄러***

쿠버네티스에서는 `Pod`라는 오브젝트를 통해 애플리케이션을 실행한다. 파드는 쿠버네티스 클러스터를 구성하는 `노드` 중 하나에 실행됨. 이때 새롭게 생성되는 파드를 어느 노드에 실행시킬지 정하는 역할을 kube-scheduler가 수행함

***컨트롤러 매니저***

쿠버네티스 리소스를 관리하고 제어하는 역할을 수행. 컨트롤러는 마스터 노드에서 실행되며 클러스터 상태를 모니터링함. 컨트롤러에는 디플로이먼트 컨트롤러, 서비스 컨트롤러, 레플리카셋 컨트롤러 등 여러 종류가 있음

각 컨트롤러는 특정 리소스 타입을 관리함

### 노드

***Kubelet***

파드 내부의 컨테이너 실행을 담당함. kubelet은 파드의 상태를 모니터링하고, 파드의 상태에 이상이 있다면 해당 파드를 다시 배포함

***Kube-proxy***

노드에서 네트워크 역할을 수행. 노드에 존재하는 파드들이 쿠버네티스 내부/외부와 네트워크 통신할 수 있게 함

***컨테이너 런타임***

컨테이너의 생명주기를 담당. 이를 위해 Kubelet은 컨테이너 런타임과 통신하는데, 이때 사용하는 것이 컨테이너 런타임 인터페이스(CRI)이다. 쿠버네티스가 사용하는 컨테이너 런타임에는 containerd, CRI-O 등이 있다. (보편적으로 containerd 사용)

***파드***

컨테이너를 실행하기 위한 오브젝트. 각 파드는 한 개 혹은 여러 개의 컨테이너를 담을 수 있음

파드는 컨테이너를 그룹화한 것이라고 보면 됨 앞서 도커의 최소 실행 단위가 컨테이너였다면 쿠버네티스의 최소 실행 단위는 파드인 것이다.

쿠버네티스에서 다수의 파드들은 여러 워커 노드에 분산되어 실행되는데, 하나의 파드에 속하는 컨테이너들은 모두 같은 노드에서 실행된다. 즉, 서로 다른 파드는 서로 다른 노드에서 실행될 수 있지만, 하나의 파드가 분할되어 여러 노드에 실행되는 일은 없다.

### 워크로드

<aside>
📖

쿠버네티스에서 실행되는 애플리케이션

하나의 컴포넌트 형태로 실행하든, 다수의 컴포넌트가 함께 실행하든 쿠버네티스는 파드 내부에서 워크로드를 실행하게 됨 이때 파드는 실행 중인 컨테이너의 집합을 나타낸다.

</aside>

***레플리카셋***

파드의 복제를 관리하며 클라이언트가 요구하는 복제본 개수만큼 파드를 복제하고 모니터링하고 관리함

***디플로이먼트***

애플리케이션의 배포와 스케일링을 관리하는 역할

***스테이트풀셋***

파드 사이에서 순서와 고유성이 보장되어야 하는 경우에 사용

***데몬셋***

쿠버네티스를 구성하는 모든 노드가 파드의 복사본을 실행하도록 함 쿠버네티스 클러스터에 새로운 노드가 추가되면 파드 역시 추가됨. 데몬셋은 주로 로깅, 모니터링, 스토리지 등과 같은 시스템 수준의 서비스를 실행하는 데 사용

***잡과 크론잡***

작업이 정상적으로 완료되고 종료되는 것을 담당함. 만약 파드가 정상적으로 종료되지 않는다면 재실행시킴

잡 - 작업이 한 번 종료되는 것을 담당

크론잡 - 동일한 작업이 스케줄에 따라 여러 번 수행하는 것을 담당

### 네트워크

***서비스***

파드를 여러 개 묶어서 클러스터 외부로 노출시킬 수 있음

이미 실행 중인 파드를 외부로 노출시키기 위해 파드 내부를 수정할 필요가 ❌

***인그레스***

쿠버네티스 내부에 존재하는 서비스를 HTTP/HTTPS 루트를 클러스터 외부로 라우팅하는 역할을 함
